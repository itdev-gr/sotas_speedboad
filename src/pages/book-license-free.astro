---
export const prerender = false;
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

const boatId = Astro.url.searchParams.get('boat')?.trim() || null;
const base = Astro.url.origin;
let boats: Array<{ id: string; name: string; imageUrl: string; imageUrls: string[]; price4h: number; price7h: number; maxPax: number; modalName: string; includes: string[]; lengthMeters: string; fuelExcludedText: string; sortOrder: number; description?: string }> = [];
try {
	const res = await fetch(`${base}/api/boats`);
	boats = res.ok ? await res.json() : [];
} catch {
	boats = [];
}
const boat = boatId ? boats.find((b) => b.id === boatId) : null;
const boatImageUrl = boat ? (boat.imageUrls && boat.imageUrls.length > 0 ? boat.imageUrls[0] : boat.imageUrl || '/images/self-drive-boat.png') : '';
---

<html lang="el">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<link rel="icon" href="/favicon.ico" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>{boat ? `${boat.name} – Book | Sotas Speedboats` : 'Book Boat | Sotas Speedboats – Zakynthos'}</title>
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet" />
	</head>
	<body class="book-license-free-body">
		<Header />
		<main class="book-license-free-page">
			{!boat ? (
				<section class="book-page-section" aria-label="Boat not found">
					<div class="book-page-inner">
						<h1 class="book-page-title">Boat not found</h1>
						<p class="book-page-text">The boat you selected could not be found or is no longer available.</p>
						<a href="/license-free-rent" class="book-page-cta">Back to License Free Rent</a>
					</div>
				</section>
			) : (
				<>
					<section class="book-page-hero" aria-label="Book this boat">
						<div class="book-page-hero-image-wrap">
							<img src={boatImageUrl} alt={boat.name} class="book-page-hero-image" />
						</div>
						<div class="book-page-hero-form-wrap">
							<div class="book-online-panel">
								<h2 class="book-online-title">Book Online</h2>
								<form class="book-online-form" id="book-online-form">
									<div class="book-online-field">
										<label for="book-date">Date</label>
										<input type="date" id="book-date" name="date" required />
									</div>
									<div class="book-online-field">
										<label for="book-time">Time</label>
										<input type="time" id="book-time" name="time" value="09:00" />
									</div>
									<div class="book-online-options">
										<label class="book-online-option">
											<input type="radio" name="duration" value="4h" checked />
											<span>4 hours</span>
											<span class="book-online-price">€{boat.price4h}</span>
										</label>
										<label class="book-online-option">
											<input type="radio" name="duration" value="7h" />
											<span>7 hours</span>
											<span class="book-online-price">€{boat.price7h}</span>
										</label>
									</div>
									<div class="book-online-field">
										<label for="book-promo">Enter Promo Code</label>
										<input type="text" id="book-promo" name="promo" placeholder="Promo code" />
									</div>
									<button type="submit" class="book-online-submit">Check Availability</button>
								</form>
							</div>
						</div>
					</section>

					<section class="book-page-section book-page-details-section" aria-label="Boat details">
						<div class="book-page-inner book-page-details-block">
							<h2 class="book-page-detail-title">{boat.name}</h2>
							{boat.modalName && <p class="book-page-modal-name">Speedboat "{boat.modalName}"</p>}
							{boat.lengthMeters && <p class="book-page-length">{boat.lengthMeters} m length</p>}
							<p class="book-page-pax">Max. {boat.maxPax} pax</p>
							<div class="book-page-prices">
								<p class="book-page-price">- 4h Rental €{boat.price4h}*</p>
								<p class="book-page-price">- 7h Rental €{boat.price7h}*</p>
							</div>
							<div class="book-page-includes">
								<p class="book-page-includes-heading">Includes:</p>
								<ul class="book-page-includes-list">
									{boat.includes.map((item) => <li>{item}</li>)}
								</ul>
								{boat.fuelExcludedText && <p class="book-page-excluded">*{boat.fuelExcludedText}</p>}
							</div>
						</div>
					</section>
				</>
			)}
		</main>
		<Footer />

		{boat && (
			<script>
				document.getElementById('book-online-form')?.addEventListener('submit', (e) => {
					e.preventDefault();
					const form = e.target as HTMLFormElement;
					const date = (form.querySelector('[name="date"]') as HTMLInputElement)?.value ?? '';
					const time = (form.querySelector('[name="time"]') as HTMLInputElement)?.value ?? '09:00';
					const duration = (form.querySelector('[name="duration"]:checked') as HTMLInputElement)?.value ?? '4h';
					const boatId = new URLSearchParams(window.location.search).get('boat') ?? '';
					const params = new URLSearchParams({ boat: boatId, date, time, duration });
					window.location.href = '/contact?' + params.toString();
				});
			</script>
		)}
	</body>
</html>

<style is:global>
	body.book-license-free-body {
		margin: 0;
		font-family: 'Inter', system-ui, sans-serif;
		background: #f5f5f5;
		color: #1a1a1a;
	}
</style>

<style>
	.book-license-free-page {
		min-height: 60vh;
		padding-bottom: 2rem;
		padding-top: 0;
	}
	.book-page-hero {
		display: grid;
		grid-template-columns: 1fr 400px;
		min-height: 380px;
		max-height: 50vh;
	}
	@media (max-width: 900px) {
		.book-page-hero {
			grid-template-columns: 1fr;
			max-height: none;
			min-height: auto;
		}
	}
	.book-page-hero-image-wrap {
		position: relative;
		overflow: hidden;
		background: #064250;
	}
	.book-page-hero-image {
		width: 100%;
		height: 100%;
		object-fit: cover;
		display: block;
	}
	.book-page-hero-form-wrap {
		display: flex;
		flex-direction: column;
		background: #fff;
	}
	.book-online-panel {
		display: flex;
		flex-direction: column;
		height: 100%;
		min-height: 320px;
	}
	.book-online-title {
		margin: 0;
		padding: 1rem 1.25rem;
		background: #3d3d3d;
		color: #fff;
		font-size: 1.1rem;
		font-weight: 600;
		text-align: center;
	}
	.book-online-form {
		padding: 1.25rem;
		display: flex;
		flex-direction: column;
		gap: 1rem;
		flex: 1;
	}
	.book-online-field {
		display: flex;
		flex-direction: column;
		gap: 0.35rem;
	}
	.book-online-field label {
		font-size: 0.9rem;
		color: #444;
		font-weight: 500;
	}
	.book-online-field input {
		padding: 0.5rem 0.75rem;
		border: 1px solid #ccc;
		border-radius: 6px;
		font-size: 1rem;
	}
	.book-online-options {
		display: flex;
		flex-direction: column;
		gap: 0.5rem;
	}
	.book-online-option {
		display: flex;
		align-items: center;
		gap: 0.75rem;
		padding: 0.5rem 0;
		cursor: pointer;
		font-size: 0.95rem;
	}
	.book-online-option input {
		accent-color: #064250;
	}
	.book-online-price {
		margin-left: auto;
		font-weight: 600;
		color: #1a1a1a;
	}
	.book-online-submit {
		margin-top: auto;
		padding: 0.75rem 1.25rem;
		background: #064250;
		color: #fff;
		border: none;
		border-radius: 6px;
		font-size: 1rem;
		font-weight: 600;
		cursor: pointer;
		transition: background 0.2s;
	}
	.book-online-submit:hover {
		background: #0a5a6a;
	}
	.book-page-section {
		max-width: 1000px;
		margin: 0 auto;
		padding: 2rem 1.5rem;
	}
	.book-page-details-section {
		padding-top: 1rem;
	}
	.book-page-inner {
		background: #fff;
		border-radius: 12px;
		box-shadow: 0 2px 12px rgba(0,0,0,0.08);
		padding: 2rem;
	}
	.book-page-details-block {
		background: #f5f0e8;
	}
	.book-page-title {
		margin: 0 0 0.75rem;
		font-size: 1.5rem;
		color: #333;
	}
	.book-page-text {
		margin: 0 0 1.5rem;
		color: #555;
	}
	.book-page-detail-title {
		margin: 0 0 0.25rem;
		font-size: 1.75rem;
		font-weight: 700;
		color: #1a1a1a;
		font-family: 'Cormorant Garamond', serif;
	}
	.book-page-modal-name {
		margin: 0 0 0.5rem;
		font-size: 1rem;
		color: #555;
	}
	.book-page-length {
		margin: 0 0 0.25rem;
		font-size: 0.9rem;
		color: #666;
	}
	.book-page-pax {
		margin: 0 0 1rem;
		font-size: 0.95rem;
		color: #444;
	}
	.book-page-prices {
		margin: 0 0 0.5rem;
	}
	.book-page-price {
		margin: 0.25rem 0;
		font-size: 1.1rem;
		font-weight: 600;
		color: #1a1a1a;
	}
	.book-page-includes-heading {
		margin: 0 0 0.5rem;
		font-size: 1rem;
		font-weight: 600;
		color: #333;
	}
	.book-page-includes-list {
		margin: 0 0 0.5rem;
		padding-left: 1.25rem;
		line-height: 1.7;
		color: #555;
	}
	.book-page-includes-list li {
		margin: 0.2rem 0;
	}
	.book-page-excluded {
		margin: 0.5rem 0 0;
		color: #888;
		font-style: italic;
		font-size: 0.9rem;
	}
	.book-page-cta {
		display: inline-block;
		padding: 0.75rem 1.5rem;
		background: #064250;
		color: #fff;
		text-decoration: none;
		font-weight: 600;
		font-size: 0.95rem;
		border-radius: 8px;
		transition: background 0.2s;
	}
	.book-page-cta:hover {
		background: #0a5a6a;
	}
</style>
