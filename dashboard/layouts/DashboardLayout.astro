---
import { verifySession } from '../lib/auth';

interface Props { title?: string }
const { title = 'Dashboard' } = Astro.props;

const session = await verifySession(Astro.request);
if (!session) {
	return Astro.redirect('/login');
}
---
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/webp" href="/logos/logo.webp" />
		<title>{title} | Freedom Wheels Dashboard</title>
		<style is:global>
			.dash { font-family: system-ui, sans-serif; background: #e8f4f7; min-height: 100vh; margin: 0; padding: 0; }
			.dash__wrap { display: flex; min-height: 100vh; margin: 0; padding: 0; }
			.dash__nav { width: 200px; background: #1d8299; color: #fff; padding: 1rem 0; margin: 0; }
			.dash__nav a { display: block; padding: 0.5rem 1rem; color: rgba(255,255,255,0.9); text-decoration: none; }
			.dash__nav a:hover { background: rgba(0,0,0,0.15); color: #fff; }
			.dash__nav .dash__nav--active { color: #fff; font-weight: 600; background: rgba(0,0,0,0.1); }
			.dash__main { flex: 1; padding: 0 1rem 1rem 0; margin: 0; }
			.dash__main h1 { margin: 0 0 1rem; font-size: 1.5rem; color: #1a1a1a; }
			.dash-card { background: #fff; border-radius: 8px; box-shadow: 0 1px 4px rgba(29,130,153,0.12); padding: 1.25rem; margin-bottom: 1rem; border: 1px solid rgba(29,130,153,0.15); }
			.dash-table { width: 100%; border-collapse: collapse; }
			.dash-table th, .dash-table td { text-align: left; padding: 0.5rem 0.75rem; border-bottom: 1px solid #eee; }
			.dash-table th { font-weight: 600; color: #444; }
			.dash-form .dash-field { margin-bottom: 1rem; }
			.dash-form label { display: block; margin-bottom: 0.25rem; font-size: 0.9rem; color: #444; }
			.dash-form input, .dash-form select, .dash-form textarea { width: 100%; max-width: 320px; padding: 0.5rem 0.6rem; border: 1px solid rgba(29,130,153,0.3); border-radius: 6px; font-size: 1rem; box-sizing: border-box; }
			.dash-form input:focus, .dash-form select:focus, .dash-form textarea:focus { outline: none; border-color: #1d8299; box-shadow: 0 0 0 2px rgba(29,130,153,0.2); }
			.dash-form textarea { min-height: 80px; resize: vertical; }
			.dash-btn { padding: 0.5rem 1rem; background: #1d8299; color: #fff; border: none; border-radius: 6px; font-size: 0.95rem; cursor: pointer; }
			.dash-btn:hover { background: #176f82; }
			.dash-btn--secondary { background: rgba(29,130,153,0.6); }
			.dash-btn--secondary:hover { background: #176f82; }
			.dash-btn--danger { background: #c00; }
			.dash-btn--danger:hover { background: #a00; }
			.dash-user { padding: 0 1rem 1rem; font-size: 0.85rem; color: rgba(255,255,255,0.85); }
			.dash-user a { color: #fff; text-decoration: underline; }
		</style>
	</head>
	<body class="dash">
		<div class="dash__wrap">
			<nav class="dash__nav">
				<a href="/dashboard" class:list={[Astro.url.pathname === '/dashboard' && 'dash__nav--active']}>Dashboard</a>
				<a href="/dashboard/inventory" class:list={[Astro.url.pathname === '/dashboard/inventory' && 'dash__nav--active']}>Inventory</a>
				<a href="/dashboard/bookings" class:list={[Astro.url.pathname === '/dashboard/bookings' && 'dash__nav--active']}>Bookings</a>
				<div class="dash-user">
					{session.email ?? session.uid}
					<br />
					<a href="/" target="_blank" rel="noopener">Site</a>
					Â·
					<button type="button" id="logout-btn" class="dash-btn dash-btn--secondary" style="margin-top: 0.5rem; width: 100%; text-align: center;">Logout</button>
				</div>
			</nav>
			<main class="dash__main">
				<slot />
			</main>
		</div>
		<script>
			document.getElementById('logout-btn')?.addEventListener('click', async () => {
				await fetch('/api/logout', { method: 'POST', credentials: 'include' });
				window.location.href = '/login';
			});
		</script>
	</body>
</html>
